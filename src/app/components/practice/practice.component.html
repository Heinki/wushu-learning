<div class="practice-container">
  <ng-container *ngIf="showOverview; else questionBlock">
    <h2>What would you like to practice?</h2>
    <div class="category-buttons">
      <button
        *ngFor="let category of categories"
        (click)="selectCategory(category)"
        class="category-button"
      >
        {{ category }}
      </button>
    </div>
  </ng-container>

  <ng-template #questionBlock>
    <div *ngIf="isLoading" class="loading-indicator">
      Loading questions...
    </div>
    <div *ngIf="!isLoading && currentQuestion && !showSummary" class="question-container" [ngClass]="{ 'box-correct': isCorrect === true, 'box-incorrect': isCorrect === false }">
      <div class="progress-indicator">
        Question {{ currentIndex }} / {{ totalQuestions }}
      </div>

      <div class="question">
        {{ currentQuestion.question }}
      </div>

      <div class="answer-input" [class.correct]="isCorrect === true" [class.incorrect]="isCorrect === false">
        <input
          type="text"
          [(ngModel)]="userAnswer"
          placeholder="Your answer"
          (keyup.enter)="checkAnswer()"
          [disabled]="checkDisabled"
        />
        <button (click)="checkAnswer()" *ngIf="!checkDisabled">Check</button>
      </div>
      <div *ngIf="showCorrectAnswer && !isCorrect" class="correct-answer">
        Correct answer: {{ currentQuestion.answer }}
      </div>

      <div *ngIf="isCorrect !== null" class="feedback">
        <span *ngIf="isCorrect">Correct!</span>
        <span *ngIf="!isCorrect">Incorrect. Try again!</span>
        <button (click)="nextQuestion()">Next Question</button>
      </div>
    </div>
    <div *ngIf="!isLoading && !currentQuestion && totalQuestions === 0" class="no-questions-message">
      <span>No questions available for this category.</span>
      <button class="back-to-categories-btn" (click)="showOverview = true">Back to Categories</button>
    </div>
    <div *ngIf="showSummary" class="summary-container">
      <h3>Practice Summary</h3>
      <table class="summary-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Question</th>
            <th>Your Answer</th>
            <th>Result</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of answerHistory; let i = index" [ngClass]="{ 'row-correct': item.correct, 'row-incorrect': !item.correct }">
            <td>{{ i + 1 }}</td>
            <td>{{ item.question }}</td>
            <td>{{ item.userAnswer }}</td>
            <td>
              <span *ngIf="item.correct">Correct</span>
              <span *ngIf="!item.correct">Incorrect</span>
            </td>
          </tr>
        </tbody>
      </table>
      <button class="back-to-categories-btn" (click)="resetPractice()">Back to Categories</button>
    </div>
  </ng-template>
</div>
